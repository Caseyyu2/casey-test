'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = createRenderer;

var _reactNative = require('react-native');

var _processStyleWithPlugins = require('../utils/processStyleWithPlugins');

var _processStyleWithPlugins2 = _interopRequireDefault(_processStyleWithPlugins);

var _styleTypes = require('../utils/styleTypes');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function createRenderer() {
  var config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

  var renderer = {
    listeners: [],
    plugins: config.plugins || [],

    clear: function clear() {
      renderer.cache = {};
      renderer.ids = [];
    },
    renderRule: function renderRule(rule) {
      var props = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

      var style = rule(props);
      var reference = JSON.stringify(style);

      if (!renderer.cache[reference]) {
        var processedStyle = (0, _processStyleWithPlugins2.default)(style, renderer.plugins, _styleTypes.RULE_TYPE);
        renderer.cache[reference] = _reactNative.StyleSheet.create({
          style: processedStyle
        });
      }

      return renderer.cache[reference].style;
    }
  };

  // initial setup
  renderer.clear();

  if (config.enhancers) {
    for (var i = 0, len = config.enhancers.length; i < len; ++i) {
      renderer = config.enhancers[i](renderer);
    }
  }

  return renderer;
}
module.exports = exports['default'];